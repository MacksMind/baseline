!!!
%html{:lang => "en"}
  %head
    %meta{:charset => "utf-8"}
    %meta{:content => "IE=edge,chrome=1", "http-equiv" => "X-UA-Compatible"}
    %meta{:name => "viewport", :content => "width=device-width, initial-scale=1.0"}
    =display_meta_tags :site => ::Baseline::AppName, :reverse => true
    = stylesheet_link_tag "application", :media => "all"
    = csrf_meta_tag
    - if Rails.env.production? && !(user_signed_in? && current_user.has_role?(:admin))
      = render 'shared/analytics'
  %body
    .container
      %header.clearfix
        .pull-right
          = link_to image_tag("AgileLogo.png", :size => "160x168", :alt => 'Agile Reasoning Logo'), root_path
        %p
          - if user_signed_in?
            = current_user.email
            \/
            = link_to "Sign out", destroy_user_session_path, :method => :delete
          - else
            = link_to "Sign up", new_user_registration_path
            or 
            = link_to "Sign in", new_user_session_path
      %nav.navbar.navbar-inverse
        .navbar-inner
          .container
            %a.btn.btn-navbar{'data-toggle' => "collapse",'data-target' => ".nav-collapse"}
              %span.icon-bar
              %span.icon-bar
              %span.icon-bar
            =link_to ::Baseline::AppName, root_path, :class => :brand
            .nav-collapse
              %ul.nav
                - if user_signed_in?
                  %li= link_to "Profile", edit_account_path
                  - if current_user.has_role?(:admin)
                    %li.dropdown
                      %a.dropdown-toggle{:href=>"#", 'data-toggle' => 'dropdown'}
                        Admin
                        %b.caret
                      %ul.dropdown-menu
                        %li= link_to 'Users', admin_users_path
      #flash
        - flash.each do |key, value|
          - key = :error if key == :failure
          %div{:class => key}= html_escape(value)
      %section#main
        = yield
      %footer
        %p.center
          #{::Baseline::AppName} is a service of Agile Reasoning &copy; 2013
    :javascript
      // Add a script element as a child of the body
      function loadDeferredJS() {
        var element = document.createElement("script");
        element.src = #{javascript_include_tag('application')[/"[^"]*"/]};
        document.body.appendChild(element);
      }

      // Check for browser support of event handling capability
      if (window.addEventListener)
        window.addEventListener("load", loadDeferredJS, false);
      else if (window.attachEvent)
        window.attachEvent("onload", loadDeferredJS);
      else
        window.onload = loadDeferredJS;
